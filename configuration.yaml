# Team Ops Assistant Configuration
# Non-secret configuration values

app:
  name: "Team Ops Assistant"
  version: "0.1.0"
  
# MongoDB database name
database:
  name: "team_ops"
  
# Timezone settings
timezone:
  # Default timezone when none can be determined
  default: "UTC"
  
  # Team timezones to show in conversions
  team_timezones:
    - "America/Los_Angeles"  # Pacific
    - "America/New_York"     # Eastern  
    - "Europe/London"        # UK
    - "Europe/Berlin"        # Central Europe
    - "Asia/Tokyo"           # Japan
    - "Australia/Sydney"     # Australia
    
  # Cities for "Pick City" fallback (timezone selection)
  team_cities:
    - name: "Los Angeles"
      tz: "America/Los_Angeles"
    - name: "New York"
      tz: "America/New_York"
    - name: "London"
      tz: "Europe/London"
    - name: "Berlin"
      tz: "Europe/Berlin"
    - name: "Tokyo"
      tz: "Asia/Tokyo"
    - name: "Sydney"
      tz: "Australia/Sydney"

# Timezone confidence settings
confidence:
  # Minimum confidence threshold to use a timezone without asking
  threshold: 0.7
  # Confidence assigned when user verifies via web flow
  verified: 1.0
  # Confidence assigned when user picks a city (explicit user action = 1.0)
  city_pick: 1.0
  # Confidence from explicit timezone in message (e.g., "3pm PST")
  message_explicit: 0.9
  # Confidence from inferred patterns
  inferred: 0.6
  # Confidence for chat default timezone
  chat_default: 0.5
  # Confidence decay per day (1.0 → 0.7 after 30 days)
  decay_per_day: 0.01

# Time parsing confidence by pattern type
time_parsing:
  confidence:
    # "3:30 PM", "14:30 AM" - most explicit
    hhmm_ampm: 0.95
    # "15h30" - European format
    european_hhmm: 0.9
    # "1500" - military time
    military: 0.9
    # "15:30" - plain HH:MM
    plain_hhmm: 0.95
    # "3pm", "3 PM" - hour with am/pm
    h_ampm: 0.9
    # "5-7pm" - range format
    range: 0.85
    # "at 3" - most ambiguous
    at_h: 0.7
  
# Deduplication settings
dedupe:
  # TTL for dedupe events in seconds (7 days)
  ttl_seconds: 604800
  # Throttle: minimum seconds between responses in same chat
  throttle_seconds: 2
  # Cache cleanup multiplier (cleanup runs every throttle_seconds * multiplier)
  cache_cleanup_multiplier: 10

# ML Classifier settings
classifier:
  # Probability thresholds for time detection
  # p > high_threshold → confident YES (skip to extraction)
  # p < low_threshold → confident NO (skip message)
  # low ≤ p ≤ high → uncertain → LLM fallback
  low_threshold: 0.40
  high_threshold: 0.60
  # Text longer than this will be split into windows
  long_text_threshold: 100
  # Context window size for long text analysis
  window_size: 5
  # TF-IDF vectorizer parameters
  tfidf:
    ngram_range: [1, 3]
    min_df: 2
    max_df: 0.95
  # Logistic regression parameters
  logistic_regression:
    max_iter: 1000
    random_state: 42
  
# LLM settings (NVIDIA NIM API - OpenAI compatible)
llm:
  # Qwen3 model for timezone resolution
  model: "qwen/qwen3-70b-instruct"
  # NVIDIA API base URL
  base_url: "https://integrate.api.nvidia.com/v1"
  # Use LLM only as fallback when rules-based parsing fails
  fallback_only: true
  # Detection-specific settings (Layer 1 fallback)
  detection:
    max_tokens: 150
    temperature: 0.1
    timeout: 10.0
  # Extraction-specific settings (Layer 2 fallback)
  extraction:
    max_tokens: 500
    temperature: 0.1
    timeout: 9.0  # HTTP timeout < sync_bridge to let inner timeout trigger first
    default_confidence: 0.8  # Default confidence for LLM-extracted times
  # Sync bridge wraps async LLM calls - outer timeout for total latency control
  sync_bridge_timeout: 10.0  # Total < 30s Telegram webhook limit
  # Circuit breaker for API resilience
  circuit_breaker:
    # Open circuit after N consecutive failures
    failure_threshold: 3
    # Try again after this many seconds
    reset_timeout_seconds: 60.0
    # Enable/disable circuit breaker
    enabled: true
  # Agent-specific settings (timezone resolution)
  agent:
    temperature: 0.3
    timeout: 15.0

# HTTP client timeouts (seconds)
http:
  timeouts:
    telegram_api: 30.0
    discord_api: 30.0
    whatsapp_api: 30.0

# UI settings
ui:
  # Maximum cities shown in city picker
  max_cities_shown: 4
  # Verification token validity (hours)
  verification_token_hours: 24

# Telegram polling settings (local development)
polling:
  # Backoff sleep on errors (seconds)
  backoff_seconds: 5
  # Long polling timeout (seconds)
  long_polling_timeout: 30
  # HTTP client timeout (seconds)
  client_timeout: 60.0

# Ngrok tunnel settings (local development)
tunnel:
  # Default port for ngrok tunnel
  default_port: 8000

# Trigger detection settings
triggers:
  # Confidence score for relocation detection
  relocation_confidence: 0.9

# Logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
